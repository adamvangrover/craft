<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Copilot Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/global_nav.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        /* Custom scrollbar for lists */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 4px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <div id="global-nav-placeholder"></div>

    <div class="flex-1 flex flex-col md:ml-64 transition-all duration-300">

        <!-- Header -->
        <header class="bg-white border-b border-slate-200 p-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-slate-800">AI Copilot Hub</h1>
                <p class="text-slate-500 text-sm">Curated prompts and tools for financial analysis.</p>
            </div>
            <div class="flex gap-3">
                <a href="copilot-quest/index.html" class="text-sm font-semibold text-indigo-600 hover:bg-indigo-50 px-4 py-2 rounded-lg transition">Copilot Quest</a>
                <a href="index.html" class="text-sm font-semibold text-slate-600 hover:bg-slate-50 px-4 py-2 rounded-lg transition">Back to Dashboard</a>
            </div>
        </header>

        <!-- Main Workspace -->
        <div class="flex flex-1 overflow-hidden">

            <!-- Sidebar: Prompt Library Navigation -->
            <aside class="w-80 bg-white border-r border-slate-200 flex flex-col">
                <div class="p-4 border-b border-slate-100">
                    <h2 class="font-bold text-slate-700 text-sm uppercase tracking-wider">Prompt Library</h2>
                </div>
                <div id="prompt-list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-4">
                    <!-- Categories and items injected here -->
                    <div class="animate-pulse space-y-4">
                        <div class="h-4 bg-slate-200 rounded w-3/4"></div>
                        <div class="h-4 bg-slate-200 rounded w-1/2"></div>
                    </div>
                </div>
            </aside>

            <!-- Content Area: Prompt Viewer -->
            <main class="flex-1 overflow-y-auto custom-scroll bg-slate-50 p-8">
                <div id="prompt-viewer" class="max-w-3xl mx-auto">
                    <div class="text-center text-slate-500 mt-20">
                        <i class="fas fa-robot text-4xl mb-4 text-indigo-200"></i>
                        <p class="text-lg">Select a prompt from the library to view.</p>
                    </div>
                </div>
            </main>

        </div>
    </div>

    <script src="js/nav_data.js"></script>
    <script src="js/global_nav.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const listContainer = document.getElementById('prompt-list');
            const viewer = document.getElementById('prompt-viewer');

            // 1. Find Prompt Libraries in navData
            function findPromptSection(items) {
                for (const item of items) {
                    if (item.text === "Ai And Coding" || item.text === "AI_and_Coding") { // Check exact text from navData
                        if (item.children) {
                            const lib = item.children.find(child => child.text === "Prompt Libraries");
                            return lib ? lib.children : null;
                        }
                    }
                    // Recursive fallback if structure varies
                    if (item.children) {
                        const result = findPromptSection(item.children);
                        if (result) return result;
                    }
                }
                return null;
            }

            // 2. Render List
            function renderList(items, parentElement) {
                items.forEach(item => {
                    if (item.type === 'category' && item.children) {
                        const details = document.createElement('details');
                        details.className = "group";
                        details.open = true; // Default open

                        const summary = document.createElement('summary');
                        summary.className = "cursor-pointer font-semibold text-slate-700 list-none flex items-center justify-between py-2 hover:text-indigo-600";
                        summary.innerHTML = `<span>${item.text}</span> <i class="fas fa-chevron-down text-xs text-slate-400 group-open:rotate-180 transition-transform"></i>`;

                        const childrenContainer = document.createElement('div');
                        childrenContainer.className = "pl-4 space-y-1 border-l border-slate-200 ml-2 mt-1 mb-3";

                        renderList(item.children, childrenContainer);

                        details.appendChild(summary);
                        details.appendChild(childrenContainer);
                        parentElement.appendChild(details);
                    } else if (item.href && (item.href.endsWith('.md') || item.href.endsWith('.prompt'))) {
                        const btn = document.createElement('button');
                        btn.className = "text-left w-full text-sm text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 py-1.5 px-2 rounded transition truncate block";
                        btn.textContent = item.text;
                        btn.onclick = () => loadPrompt(item.href, item.text);
                        parentElement.appendChild(btn);
                    }
                });
            }

            // 3. Load Prompt Content
            async function loadPrompt(url, title) {
                viewer.innerHTML = `
                    <div class="animate-pulse space-y-4">
                        <div class="h-8 bg-slate-200 rounded w-1/3 mb-8"></div>
                        <div class="h-40 bg-slate-200 rounded w-full"></div>
                    </div>`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error("Failed to load prompt.");
                    const text = await response.text();

                    // Render Markdown
                    const htmlContent = marked.parse(text);

                    viewer.innerHTML = `
                        <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200">
                            <div class="flex justify-between items-start mb-6 border-b border-slate-100 pb-4">
                                <h2 class="text-2xl font-bold text-slate-800">${title}</h2>
                                <button onclick="copyToClipboard()" class="text-sm bg-indigo-50 text-indigo-600 hover:bg-indigo-100 px-3 py-1.5 rounded-md font-medium transition flex items-center gap-2">
                                    <i class="far fa-copy"></i> Copy Raw
                                </button>
                            </div>
                            <div id="prompt-content" class="prose prose-slate prose-indigo max-w-none text-sm">
                                ${htmlContent}
                            </div>
                        </div>
                        <div class="hidden" id="raw-content">${text}</div>
                    `;

                } catch (e) {
                    viewer.innerHTML = `<p class="text-red-500">Error loading prompt: ${e.message}</p>`;
                }
            }

            // 4. Global Copy Function
            window.copyToClipboard = () => {
                const rawText = document.getElementById('raw-content').textContent;
                navigator.clipboard.writeText(rawText).then(() => {
                    const btn = document.querySelector('button[onclick="copyToClipboard()"]');
                    const originalHTML = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    btn.classList.add('bg-green-50', 'text-green-600');
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.classList.remove('bg-green-50', 'text-green-600');
                    }, 2000);
                });
            };

            // Initialize
            if (typeof navData !== 'undefined') {
                const promptItems = findPromptSection(navData);
                if (promptItems) {
                    listContainer.innerHTML = '';
                    renderList(promptItems, listContainer);
                } else {
                    listContainer.innerHTML = '<p class="text-slate-400 text-sm">Prompt libraries not found.</p>';
                }
            }
        });
    </script>
</body>
</html>
