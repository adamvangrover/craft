{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SentinelAgentInteraction",
  "description": "Defines the request and response schema for the Sentinel Data Integrity Agent.",
  "type": "object",
  "properties": {
    "request": {
      "description": "The input packet required by the Sentinel agent.",
      "type": "object",
      "properties": {
        "data_file_content": {
          "description": "The content of the data file to be validated, typically as a base64 encoded string or a string containing CSV/JSON data.",
          "type": "string"
        },
        "file_schema": {
          "description": "A JSON object defining the expected structure of the data file.",
          "type": "object",
          "properties": {
            "fields": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "type": { "type": "string", "enum": ["string", "integer", "float", "date", "boolean"] },
                  "is_nullable": { "type": "boolean" }
                },
                "required": ["name", "type", "is_nullable"]
              }
            }
          },
          "required": ["fields"]
        },
        "business_rules": {
          "description": "An array of business rules to apply to the data.",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "field": { "type": "string" },
              "rule": { "type": "string", "enum": ["between", "in_set", "greater_than_field", "matches_regex"] },
              "values": { "type": "array" }
            },
            "required": ["field", "rule", "values"]
          }
        }
      },
      "required": ["data_file_content", "file_schema", "business_rules"]
    },
    "response": {
      "description": "The JSON output (Data Quality Report) generated by the Sentinel agent.",
      "type": "object",
      "properties": {
        "report_summary": {
          "type": "object",
          "properties": {
            "input_filename": { "type": "string" },
            "total_records_processed": { "type": "integer" },
            "total_records_with_errors": { "type": "integer" },
            "total_errors_found": { "type": "integer" },
            "data_quality_score": { "type": "number" },
            "validation_status": { "type": "string", "enum": ["Passed", "Failed"] },
            "timestamp_utc": { "type": "string", "format": "date-time" }
          },
          "required": ["input_filename", "total_records_processed", "total_records_with_errors", "total_errors_found", "data_quality_score", "validation_status", "timestamp_utc"]
        },
        "detected_anomalies": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "record_id": { "type": "string" },
              "field_name": { "type": "string" },
              "error_type": { "type": "string", "enum": ["SCHEMA_VIOLATION", "RULE_VIOLATION", "ML_ANOMALY"] },
              "error_description": { "type": "string" },
              "erroneous_value": { "type": ["string", "number", "boolean", "null"] }
            },
            "required": ["record_id", "field_name", "error_type", "error_description", "erroneous_value"]
          }
        }
      },
      "required": ["report_summary", "detected_anomalies"]
    }
  }
}
