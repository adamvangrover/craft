<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Knowledge Showcase | Financial Learning Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cytoscape@3.23.0/dist/cytoscape.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        #cy { width: 100%; height: 600px; background: #f8fafc; border-radius: 0.75rem; border: 1px solid #e2e8f0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-8 py-4 flex justify-between items-center shadow-sm sticky top-0 z-10">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                <i class="fas fa-network-wired"></i>
            </div>
            <div>
                <h1 class="font-bold text-xl text-slate-800">AI Knowledge Showcase</h1>
                <p class="text-xs text-slate-500 font-medium">Machine-Readable Assets & Ontology</p>
            </div>
        </div>
        <div>
            <a href="practice_center.html" class="text-sm font-bold text-slate-500 hover:text-indigo-600 mr-4">Analyst Workbench</a>
            <a href="home.html" class="bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-800 transition-colors">Exit to Hub</a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-8 py-12 space-y-12">

        <!-- Intro -->
        <section class="grid md:grid-cols-2 gap-12 items-center">
            <div>
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Bridging Human & Machine Intelligence</h2>
                <p class="text-slate-600 leading-relaxed mb-6">
                    This repository is architected to be consumed by both human analysts and AI agents.
                    We have extracted the entire content library into structured JSONL, built a semantic knowledge graph, and formalized decision logic into traversable trees.
                </p>
                <div class="flex gap-4">
                    <a href="comprehensive_knowledge_base/knowledge_base.jsonl" download class="flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg font-bold text-sm hover:bg-indigo-100 border border-indigo-200 transition-all">
                        <i class="fas fa-file-code"></i> Download JSONL
                    </a>
                    <a href="comprehensive_knowledge_base/knowledge_graph.json" download class="flex items-center gap-2 px-4 py-2 bg-pink-50 text-pink-700 rounded-lg font-bold text-sm hover:bg-pink-100 border border-pink-200 transition-all">
                        <i class="fas fa-project-diagram"></i> Download Graph
                    </a>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                <h3 class="text-sm font-bold text-slate-500 uppercase mb-4">Repository Stats</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <div class="text-2xl font-bold text-indigo-600" id="stat-chunks">---</div>
                        <div class="text-xs text-slate-500 font-bold">Knowledge Chunks</div>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <div class="text-2xl font-bold text-pink-600" id="stat-nodes">---</div>
                        <div class="text-xs text-slate-500 font-bold">Graph Nodes</div>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <div class="text-2xl font-bold text-teal-600" id="stat-trees">---</div>
                        <div class="text-xs text-slate-500 font-bold">Decision Trees</div>
                    </div>
                    <div class="p-4 bg-slate-50 rounded-lg">
                        <div class="text-2xl font-bold text-orange-600" id="stat-terms">---</div>
                        <div class="text-xs text-slate-500 font-bold">Ontology Terms</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Knowledge Graph Viz -->
        <section class="scroll-mt-24" id="graph-section">
            <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900">Semantic Knowledge Graph</h2>
                    <p class="text-slate-500">Visualizing the connections between concepts, files, and modules.</p>
                </div>

                <div class="flex flex-col items-end gap-2 w-full md:w-auto">
                    <div class="relative w-full md:w-64">
                        <input type="text" id="search-input" placeholder="Search nodes..." class="w-full pl-9 pr-3 py-2 text-sm bg-white border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-sm">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    </div>
                    <div class="flex gap-2">
                         <span class="flex items-center gap-1 text-xs font-bold text-slate-500"><span class="w-3 h-3 rounded-full bg-indigo-500"></span> File</span>
                         <span class="flex items-center gap-1 text-xs font-bold text-slate-500"><span class="w-3 h-3 rounded-full bg-emerald-500"></span> Concept</span>
                         <span class="flex items-center gap-1 text-xs font-bold text-slate-500"><span class="w-3 h-3 rounded-full bg-slate-400"></span> Chunk</span>
                    </div>
                </div>
            </div>
            <div id="cy" class="shadow-inner"></div>
        </section>

        <!-- Decision Trees -->
        <section>
            <h2 class="text-2xl font-bold text-slate-900 mb-6">Logic & Decision Trees</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl border border-slate-200 h-96 overflow-y-auto">
                    <h3 class="text-sm font-bold text-slate-500 uppercase mb-4">Available Logic Flows</h3>
                    <div id="tree-list" class="space-y-2">
                        <!-- Populated by JS -->
                    </div>
                </div>
                <div class="bg-slate-900 text-green-400 p-6 rounded-xl font-mono text-sm overflow-auto h-96 shadow-inner relative group">
                    <div class="absolute top-4 right-4 text-xs text-slate-500 uppercase font-bold">JSON Representation</div>
                    <button id="copy-json" class="absolute bottom-4 right-4 bg-slate-800 text-white px-3 py-1 rounded text-xs opacity-0 group-hover:opacity-100 transition-opacity">Copy JSON</button>
                    <pre id="json-viewer" class="whitespace-pre-wrap">Select a tree to view structure...</pre>
                </div>
            </div>
        </section>

        <!-- Ontology -->
        <section>
            <h2 class="text-2xl font-bold text-slate-900 mb-6">System Ontology (TTL)</h2>
            <div class="bg-white p-8 rounded-xl border border-slate-200 font-mono text-sm text-slate-600 whitespace-pre overflow-x-auto shadow-sm">
@prefix : &lt;http://credit-analysis.org/ontology/&gt; .
@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt; .

:KnowledgeChunk a owl:Class ;
    rdfs:label "Knowledge Chunk" ;
    rdfs:comment "Atomic unit of information extracted from markdown." .

:File a owl:Class ;
    rdfs:label "File" .

:Concept a owl:Class ;
    rdfs:label "Concept" ;
    rdfs:comment "Financial term or entity defined in the glossary." .

:DecisionNode a owl:Class ;
    rdfs:label "Decision Node" ;
    rdfs:comment "A step in a checklist or logic flow." .

:contains a owl:ObjectProperty ;
    rdfs:domain :File ;
    rdfs:range :KnowledgeChunk .

:mentions a owl:ObjectProperty ;
    rdfs:domain :KnowledgeChunk ;
    rdfs:range :Concept .
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-slate-200 py-12 mt-12">
        <div class="max-w-7xl mx-auto px-8 text-center">
            <p class="text-slate-400 text-sm">Generated by Jules for the Financial Learning Hub. | <a href="#" class="hover:text-indigo-600">Privacy</a> | <a href="#" class="hover:text-indigo-600">Terms</a></p>
            <p class="text-xs text-slate-300 mt-2">Knowledge Graph v2.1 â€¢ Last Updated: <span id="last-updated">Today</span></p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            let cy; // Global Cytoscape instance

            // Load Knowledge Graph Data
            try {
                const response = await fetch('comprehensive_knowledge_base/knowledge_graph.json');
                const data = await response.json();

                // Update Stats
                const fileNodes = data.nodes.filter(n => n.type === 'File').length;
                const conceptNodes = data.nodes.filter(n => n.type === 'Concept').length;
                const chunkNodes = data.nodes.filter(n => n.type === 'Chunk').length;

                document.getElementById('stat-nodes').textContent = data.nodes.length;
                document.getElementById('stat-chunks').textContent = chunkNodes;
                document.getElementById('stat-terms').textContent = conceptNodes;

                // Initialize Cytoscape
                // Sample subset to avoid crashing browser if too large
                const limit = 300;
                const subsetNodes = data.nodes.slice(0, limit);
                const subsetNodeIds = new Set(subsetNodes.map(n => n.id));
                const subsetEdges = data.edges.filter(e => subsetNodeIds.has(e.source) && subsetNodeIds.has(e.target));

                cy = cytoscape({
                    container: document.getElementById('cy'),
                    elements: [
                        ...subsetNodes.map(n => ({
                            data: { id: n.id, label: n.label || '', type: n.type }
                        })),
                        ...subsetEdges.map(e => ({
                            data: { source: e.source, target: e.target }
                        }))
                    ],
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'label': 'data(label)',
                                'text-valign': 'center',
                                'text-halign': 'center',
                                'font-size': '10px',
                                'width': 25,
                                'height': 25,
                                'color': '#475569',
                                'background-color': '#cbd5e1'
                            }
                        },
                        {
                            selector: 'node[type="File"]',
                            style: { 'background-color': '#6366f1', 'width': 45, 'height': 45, 'color': '#fff', 'text-outline-width': 2, 'text-outline-color': '#4f46e5' }
                        },
                         {
                            selector: 'node[type="Concept"]',
                            style: { 'background-color': '#10b981', 'width': 35, 'height': 35, 'color': '#fff' }
                        },
                         {
                            selector: 'node[type="Chunk"]',
                            style: { 'background-color': '#94a3b8', 'opacity': 0.6, 'width': 15, 'height': 15, 'label': '' }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 1,
                                'line-color': '#e2e8f0',
                                'curve-style': 'bezier'
                            }
                        },
                        {
                            selector: '.highlighted',
                            style: {
                                'background-color': '#f43f5e',
                                'line-color': '#f43f5e',
                                'target-arrow-color': '#f43f5e',
                                'transition-property': 'background-color, line-color, target-arrow-color',
                                'transition-duration': '0.5s'
                            }
                        },
                        {
                            selector: '.dimmed',
                            style: {
                                'opacity': 0.1
                            }
                        }
                    ],
                    layout: {
                        name: 'cose',
                        animate: false,
                        randomize: true,
                        nodeRepulsion: 400000
                    }
                });

                // Search Functionality
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    cy.batch(() => {
                        cy.elements().removeClass('highlighted dimmed');
                        if (term.length > 1) {
                            const hits = cy.nodes().filter(n => n.data('label').toLowerCase().includes(term));
                            if (hits.length > 0) {
                                cy.elements().addClass('dimmed');
                                hits.removeClass('dimmed').addClass('highlighted');
                                hits.neighborhood().removeClass('dimmed').addClass('highlighted');
                            }
                        }
                    });
                });

            } catch (e) {
                console.error("Failed to load KG", e);
                document.getElementById('cy').innerHTML = '<div class="flex items-center justify-center h-full text-slate-400">Graph data not available. Ensure comprehensive_knowledge_base is generated.</div>';
            }

            // Load Decision Trees
            try {
                const response = await fetch('comprehensive_knowledge_base/decision_trees.json');
                const trees = await response.json();
                const list = document.getElementById('tree-list');
                const viewer = document.getElementById('json-viewer');

                document.getElementById('stat-trees').textContent = Object.keys(trees).length;

                Object.values(trees).forEach(tree => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left px-4 py-3 bg-slate-50 hover:bg-indigo-50 rounded-lg border border-slate-200 text-sm font-medium text-slate-700 transition-colors focus:ring-2 focus:ring-indigo-500 focus:outline-none";
                    btn.textContent = tree.title;
                    btn.onclick = () => {
                        viewer.textContent = JSON.stringify(tree, null, 2);
                    };
                    list.appendChild(btn);
                });

                document.getElementById('copy-json').addEventListener('click', () => {
                    navigator.clipboard.writeText(viewer.textContent);
                });

            } catch (e) {
                 console.error("Failed to load Trees", e);
            }
        });
    </script>
</body>
</html>
